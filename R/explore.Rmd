---
title: "explore"
output: html_document
date: "2023-06-20"
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "~/network-storage/WNV/sjv-wnv/")
library(ggplot2)
library(dplyr)
library(corrplot)
library(knitr)
```

## Birds
```{r}
bird_files <- list.files("Data/birds", full.names = T)

bird_data <- list()

for(file in bird_files) {
  bird_data[[file]] <- read.csv(file) %>% 
    arrange(clust, Year) %>% 
    group_by(clust, Year) %>% 
    arrange(Month, .by_group = T) %>% 
    ungroup()
}

for(df in bird_data){
   print(sapply(df, var))
}
```

## Pooled 

```{r}
pool_files <- list.files("Data/pools", full.names = T)

pool_data <- list()

for(file in pool_files) {
  pool_data[[file]] <- read.csv(file) %>% 
    arrange(clust, Year) %>% 
    group_by(clust, Year) %>% 
    arrange(Month, .by_group = T) %>% 
    ungroup()
}
```

## Sentinel

```{r}
sentinel_files <- list.files("Data/sentinels", full.names = T)

sentinel_data <- list()

for(file in sentinel_files) {
  sentinel_data[[file]] <- read.csv(file) %>% 
    arrange(clust, Year) %>% 
    group_by(clust, Year) %>% 
    arrange(Month, .by_group = T) %>% 
    ungroup()
}
```


## Missing data 
```{r, fig.width=8, fig.height=8}
focus_data <- pool_data$`Data/pools/pool1500Lag0.csv`

naniar::gg_miss_fct(focus_data %>% filter(!is.na(z)), fct = yrs)
naniar::gg_miss_fct(focus_data %>% filter(!is.na(z)), fct = mnths)
naniar::gg_miss_fct(focus_data %>% filter(!is.na(z)), fct = clust)
naniar::gg_miss_fct(focus_data, fct = clust)

focus_data %>% filter(is.na(z)) %>% select(mnths, yrs, clust, everything())

# see unique missing observations by cluster
clust_n_missing <- focus_data %>% 
  group_by(clust) %>% 
  summarise(n_missing = sum(is.na(z))) %>% 
  ungroup()

clust_n_missing %>% arrange(n_missing)
clust_n_missing %>% arrange(desc(n_missing))

gg_miss_upset(focus_data)

focus_data %>% filter(clust == 779)
focus_data %>% filter(clust == 23)


focus_data <- pool_data$`Data/pools/pool2000Lag0.csv`

focus_data %>% filter((Count + CountLinear + CountSpline) > 0) %>% 
  summary()

focus_data <- pool_data$`Data/pools/pool3000Lag0.csv`

focus_data %>% filter((Count + CountLinear + CountSpline) > 0) %>% 
  summary()
```


```{r}
bird_data_1500 <- bird_data$`Data/birds/bird1500Lag0.csv`
bird_data_2000 <- bird_data$`Data/birds/bird2000Lag0.csv`
bird_data_3000 <- bird_data$`Data/birds/bird3000Lag0.csv`

pool_data_1500 <- pool_data$`Data/pools/pool1500Lag0.csv`
pool_data_2000 <- pool_data$`Data/pools/pool2000Lag0.csv`
pool_data_3000 <- pool_data$`Data/pools/pool3000Lag0.csv`

sentinel_data_1500 <- sentinel_data$`Data/sentinels/sentinel1500Lag0.csv`
sentinel_data_2000 <- sentinel_data$`Data/sentinels/sentinel2000Lag0.csv`
sentinel_data_3000 <- sentinel_data$`Data/sentinels/sentinel3000Lag0.csv`


densityPlotFunc <- function(data){
  
  return(lapply(names(data), function(var_x){
    p <- 
      ggplot(data) +
      aes(var_x)
  
    if(is.numeric(data[[var_x]])) {
      p <- p + geom_density()
  
    } else {
      p <- p + geom_bar()
    } 
  }))
  
  
}

bird_data_1500_plots <- densityPlotFunc(bird_data_1500)
bird_data_2000_plots <- densityPlotFunc(bird_data_2000)
bird_data_3000_plots <- densityPlotFunc(bird_data_3000)

pool_data_1500_plots <- densityPlotFunc(pool_data_1500)
pool_data_2000_plots <- densityPlotFunc(pool_data_2000)
pool_data_3000_plots <- densityPlotFunc(pool_data_3000)

sentinel_data_1500_plots <- densityPlotFunc(sentinel_data_1500)
sentinel_data_2000_plots <- densityPlotFunc(sentinel_data_2000)
sentinel_data_3000_plots <- densityPlotFunc(sentinel_data_3000)
 
```

```{r}
plot_grid(plotlist = bird_data_1500_plots)
plot_grid(plotlist = pool_data_1500_plots)
plot_grid(plotlist = sentinel_data_1500_plots)
```


## Correlation 
```{r, fig.height=16, fig.width=16}

corrPlotFn <- function(data) {
  numeric_vars <- sapply(data, is.numeric)
  numeric_data <- data[, numeric_vars]

  corr_matrix <- cor(numeric_data)

  corrplot(corr_matrix, type = 'lower', diag = FALSE, method = 'color')
}

# look at lags of correlation matrices
corrPlotFn(bird_data_1500)
corrPlotFn(pool_data_1500)
corrPlotFn(sentinel_data_1500)
cor(bird_data_1500)
kable(cor(bird_data_1500$Count, bird_data_1500[, -which(names(bird_data_1500) == "Count")]))
```

